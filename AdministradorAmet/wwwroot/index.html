<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AdministradorAmet</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="AdministradorAmet.styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="_content/Radzen.Blazor/css/material-base.css" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="styles.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="_content/Blazored.Modal/blazored-modal.css" />

    
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">游딏</a>
    </div>


    <script>
        window.GenerarPDF = async (tickets) => {
            console.log("GenerarPDF function called");

            var doc = new jsPDF();
            console.log("jsPDF instance created");

            // Establecer fuente
            doc.setFont("times", "bold");

            // IMAGEN
            var img = new Image();
            img.src = "logo.png";
            img.crossOrigin = "";
            img.onload = function () {
                console.log("Image loaded");

                // Agregar imagen al lado izquierdo
                const imgX = 20;
                const imgY = 10;
                doc.addImage(this, 'PNG', imgX, imgY, 40, 40);

                // Contenido en el lado derecho del encabezado
                doc.setFontSize(16);
                const contentX = 75;

                // Texto "Sistema de Gesti칩n de Multas de Tr치nsito"
                const systemTextY = 25;
                doc.text(contentX, systemTextY, "Sistema de Gesti칩n de Multas de Tr치nsito");

                // T칤tulo "Reporte de Multas" ajustado hacia la derecha
                const reportTextY = systemTextY + 10;
                const title = "Reporte de Multas";
                const titleWidth = doc.getTextDimensions(title).w;

                const titleOffsetX = 23;
                const titleX = contentX + ((doc.internal.pageSize.width - contentX) - titleWidth) / 2 + titleOffsetX;
                doc.text(titleX, reportTextY, title);

                // L칤nea divisora debajo del encabezado
                const lineStartX = 60;
                const lineEndX = doc.internal.pageSize.width - 20;
                const lineY = reportTextY + 5;
                doc.setLineWidth(0.5); // Grosor de la l칤nea para la primera l칤nea divisoria
                doc.line(lineStartX, lineY, lineEndX, lineY);

                // T칤tulos de columnas
                const startY = lineY + 25;
                doc.setFontSize(12);
                let rowY = startY;

                //// Agregar la columna de numeraci칩n (vac칤a en el encabezado)
                //doc.text(10, rowY, "N춿");

                // T칤tulos de las otras columnas
                doc.text(20, rowY, "Nombre Completo");
                doc.text(60, rowY, "C칠dula");
                doc.text(90, rowY, "Fecha");
                doc.text(115, rowY, "Multa");
                doc.text(135, rowY, "Estado");
                doc.text(155, rowY, "Infracci칩n");
                doc.text(180, rowY, "N춿 Agente");

                // Datos de la tabla
                rowY += 10;
                doc.setFont("times", "normal"); // Quitar negrita para los datos

                tickets.forEach((ticket, index) => {
                    const status = ticket.status === "Paid" ? "Pagada" : ticket.status === "pending" ? "Pendiente" : ticket.status;

                    //// Agregar n칰mero de fila
                    //const numColumnX = 10;
                    //doc.text(numColumnX, rowY, (index + 1).toString()); // Contador de fila: "1", "2", "3", ...

                    // Resto de las columnas
                    doc.text(20, rowY, `${ticket.name} ${ticket.lastName}`);
                    doc.text(60, rowY, ticket.identification);
                    doc.text(90, rowY, ticket.ticketDate);
                    doc.text(120, rowY, ticket.ticketId.toString());
                    doc.text(135, rowY, status);
                    doc.text(155, rowY, ticket.articulo);
                    doc.text(185, rowY, ticket.agentNumber.toString());

                    rowY += 10;
                });


                // PIE DE P츼GINA
                var today = new Date();
                var dateTime =
                    "Fecha: " +
                    today.getDate().toString().padStart(2, '0') + '/' +
                    (today.getMonth() + 1).toString().padStart(2, '0') + '/' +
                    today.getFullYear() + ' Hora: ' +
                    today.getHours().toString().padStart(2, '0') + ':' +
                    today.getMinutes().toString().padStart(2, '0');

                doc.setFontSize(12);
                doc.text(20, 290, "Elaborado por: Administrador");
                doc.text(140, 290, dateTime);

                // Generar el PDF como Blob y usar FileSaver para descargar
                var blob = doc.output('blob');
                saveAs(blob, 'Reporte.pdf');
                console.log("PDF saved");
            };

            img.onerror = function () {
                console.error("Failed to load image");
            };
        };


    </script>

    <script type="text/javascript">
        function Print() {
            var divcontent = document.getElementById("resultadoreporte").innerHTML;
            var a = window.open('', '', 'height=1300,width=1300');
            a.document.write('<html>');
            a.document.write('<body><br/>');
            a.document.write(divcontent);
            a.document.write('<body></html>')
            a.document.close();
            a.print();
        }


    </script>


    <script type="text/javascript">
        function PrintMulta() {
            var divcontent = document.getElementById("resultadomulta").innerHTML;
            var a = window.open('', '', 'height=1300,width=1300');
            a.document.write('<html>');
            a.document.write('<body><br/>');
            a.document.write(divcontent);
            a.document.write('<body></html>')
            a.document.close();
            a.print();
        }


    </script>


    <!-- Aseg칰rate de cargar primero la librer칤a html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>

    <!-- Scripts adicionales que ya tienes -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.0.272/jspdf.debug.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script src="_content/Radzen.Blazor/Radzen.Blazor.js"></script>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>
    <script src="print.js"></script>
    <script src="js/site.js"></script>
    <script src="jquery/jquery.min.js"></script>





</body>
</html>